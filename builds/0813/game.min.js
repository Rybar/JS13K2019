!function(){function e(e,t=1,n=0,i=.5,a=!1){var o=audioCtx.createBufferSource(),r=audioCtx.createGain(),c=audioCtx.createStereoPanner();return o.buffer=e,o.connect(c),c.connect(r),r.connect(audioMaster),o.playbackRate.value=t,o.loop=a,r.gain.value=i,c.pan.value=n,o.start(),{volume:r,sound:o}}function t(e,t,n,i,a,o,r,c){let d=((r-a)*(t-o)-(c-o)*(e-a))/((c-o)*(n-e)-(r-a)*(i-t)),s=((n-e)*(t-o)-(i-t)*(e-a))/((c-o)*(n-e)-(r-a)*(i-t));if(0>d||d>1||0>s||s>1)return!1;return[e+d*(n-e),t+d*(i-t)]}function n(e,t,n,i,a="#F0F"){ctx.fillStyle=a,ctx.fillRect(e,t,n,i)}Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}};var i=function(){var e,t,n,i,a,o=function(e){return Math.sin(6.283184*e)},r=function(e){return.003959503758*Math.pow(2,(e-128)/12)},c=function(e,t,n){var i,a,o,c,s,u,l,f=d[e.i[0]],h=e.i[1],p=e.i[3],w=d[e.i[4]],g=e.i[5],v=e.i[8],m=e.i[9],y=e.i[10]*e.i[10]*4,x=e.i[11]*e.i[11]*4,M=e.i[12]*e.i[12]*4,C=1/M,L=e.i[13],k=n*Math.pow(2,2-e.i[14]),E=new Int32Array(y+x+M),P=0,D=0;for(i=0,a=0;y+x+M>i;i++,a++)0>a||(a-=k,u=r(t+(15&(L=L>>8|(255&L)<<4))+e.i[2]-128),l=r(t+(15&L)+e.i[6]-128)*(1+8e-4*e.i[7])),o=1,y>i?o=i/y:y+x>i||(o-=(i-y-x)*C),c=u,p&&(c*=o*o),s=f(P+=c)*h,c=l,v&&(c*=o*o),s+=w(D+=c)*g,m&&(s+=(2*Math.random()-1)*m),E[i]=80*s*o|0;return E},d=[o,function(e){return.5>e%1?1:-1},function(e){return e%1*2-1},function(e){var t=e%1*4;return 2>t?t-1:3-t}];this.init=function(o){e=o,t=o.endPattern,n=0,i=o.rowLen*o.patternLen*(t+1)*2,a=new Int32Array(i)},this.generate=function(){var r,s,u,l,f,h,p,w,g,v,m,y,x,M,C=new Int32Array(i),L=e.songData[n],k=e.rowLen,E=e.patternLen,P=0,D=0,K=!1,S=[];for(u=0;t>=u;++u)for(p=L.p[u],l=0;E>l;++l){var A=p?L.c[p-1].f[l]:0;A&&(L.i[A-1]=L.c[p-1].f[l+E]||0,16>A&&(S=[]));var F=d[L.i[15]],R=L.i[16]/512,I=Math.pow(2,L.i[17]-9)/k,_=L.i[18],T=L.i[19],b=43.23529*L.i[20]*3.141592/44100,W=1-L.i[21]/255,O=1e-5*L.i[22],G=L.i[23]/32,U=L.i[24]/512,j=6.283184*Math.pow(2,L.i[25]-9)/k,B=L.i[26]/255,H=L.i[27]*k&-2;for(m=(u*E+l)*k,f=0;4>f;++f)if(h=p?L.c[p-1].n[l+f*E]:0){S[h]||(S[h]=c(L,h,k));var N=S[h];for(s=0,r=2*m;s<N.length;s++,r+=2)C[r]+=N[s]}for(s=0;k>s;s++)(v=C[w=2*(m+s)])||K?(y=b,_&&(y*=F(I*w)*R+.5),D+=(y=1.5*Math.sin(y))*(x=W*(v-D)-(P+=y*D)),v=3==T?D:1==T?x:P,O&&(v=1>(v*=O)?v>-1?o(.25*v):-1:1,v/=O),K=(v*=G)*v>1e-5,M=v*(1-(g=Math.sin(j*w)*U+.5)),v*=g):M=0,H>w||(M+=C[w-H+1]*B,v+=C[w-H]*B),C[w]=0|M,C[w+1]=0|v,a[w]+=0|M,a[w+1]+=0|v}return++n/e.numChannels},this.createWave=function(){var e=44+2*i-8,t=e-36,n=new Uint8Array(44+2*i);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var o=0,r=44;i>o;++o){var c=a[o];c=-32767>c?-32767:c>32767?32767:c,n[r++]=255&c,n[r++]=c>>8&255}return n},this.getBuffer=function(){return a},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),i=new Array(t),o=0;2*t>o;o+=1){var r=n+o;i[o]=e>0&&r<a.length?a[r]/32768:0}return i}},a={songData:[{i:[3,138,116,0,0,138,128,4,0,0,47,48,166,124,3,0,139,4,1,3,64,160,3,32,147,4,121,5],p:[1,1,4,2,3],c:[{n:[111],f:[]},{n:[114],f:[]},{n:[113],f:[]},{n:[112,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,113],f:[]}]}],rowLen:5513,patternLen:32,endPattern:4,numChannels:1},o={songData:[{i:[2,138,116,0,2,138,128,4,0,0,1,29,52,124,3,0,139,4,1,3,64,160,3,32,147,4,57,5],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,150],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[1],c:[{n:[],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:2};states={},init=(()=>{audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),audioMaster.connect(audioCtx.destination),fps=60,tick=1/60,dt=0,start=elapsed=now=last=timeStamp(),sounds={},c.width=640,c.height=360,c.style="width: 1280px; height: 720px",ctx=c.getContext("2d"),music=new i,music.init(a),done=!1,soundsReady=0,sndData=[{name:"song",data:a},{name:"cellComplete",data:o}],sndData.forEach(function(t){var n=new i;n.init(t.data);var a=!1;setInterval(function(){if(!a&&(a=1==n.generate())){let i=n.createWave().buffer;audioCtx.decodeAudioData(i,function(n){sounds[t.name]=n,soundsReady++,gameSong=e(sounds.song,1,0,.5,!0)})}},0)}),paused=!1,loop()}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),loop=(()=>{for(now=timeStamp(),dt+=Math.min(1,(now-last)/1e3),elapsed=now-start;dt>tick;)dt-=tick,step(tick);draw(dt),requestAnimationFrame(loop)}),step=(t=>{Key.justReleased(Key.a)&&(e(sounds.cellComplete,1,0,.5,!1),Key.update())}),draw=(e=>{let i="green";n(0,0,c.width,c.height,"#303");let a=100+50*Math.sin(elapsed/1e3),o=100+50*Math.cos(elapsed/1e3),r=c.width/2+Math.sin(elapsed/1e3)*c.height/2,d=c.height/2+Math.cos(elapsed/1e3)*c.height/2,s=c.width/2+Math.sin(elapsed/1e3+Math.PI)*c.height/2,u=c.height/2+Math.cos(elapsed/1e3+Math.PI)*c.height/2;collide=function(e,n,i,a,o,r,c,d){let s=t(e,n,i,a,o,r,o,r+d),u=t(e,n,i,a,o+c,r,o+c,r+d),l=t(e,n,i,a,o,r,o+c,r),f=t(e,n,i,a,o,r+d,o+c,r+d);return!!(s||u||l||f)&&[s,u,l,f]}(r,d,s,u,a,o,64,64),collide&&(i="red"),n(a,o,64,64,i),function(e,t,n,i,a=1,o="#F0F"){ctx.beginPath(),ctx.moveTo(e,t),ctx.lineTo(n,i),ctx.lineWidth=a,ctx.strokeStyle=o,ctx.stroke()}(r,d,s,u,3),collide&&collide.forEach(function(e){e&&(console.log(e),function(e,t,n=4,i="#FF0"){ctx.fillStyle=i,ctx.beginPath(),ctx.arc(e,t,n,0,2*Math.PI),ctx.fill()}(e[0],e[1]))})}),timeStamp=(()=>window.performance&&window.performance.now?window.performance.now():(new Date).getTime()),window.init()}();
!function(){function e(e,t=1,n=0,a=.5,i=!1){var r=audioCtx.createBufferSource(),o=audioCtx.createGain(),s=audioCtx.createStereoPanner();return r.buffer=e,r.connect(s),s.connect(o),o.connect(audioMaster),r.playbackRate.value=t,r.loop=i,o.gain.value=a,s.pan.value=n,r.start(),{volume:o,sound:r}}states={},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}};class t{constructor(e){if(e%1!=0)throw new Error("Seed value must be an integer.");this.seed=e%2147483647,this.seed>0||(this.seed+=2147483646)}next(){return this.seed=16807*this.seed%2147483647}nextFloat(){return(this.next()-1)/2147483646}nextBoundedInt(e,t){return Math.floor(this.nextFloat()*(t-e)+e)}}boxBox=((e,t)=>{let n=e.x,a=e.x+e.width,i=e.y,r=e.y+e.height,o=t.x,s=t.x+t.width,d=t.y,c=t.y+t.height;return!(o>a||n>s||d>r||i>c)});var n=function(){var e,t,n,a,i,r=function(e){return Math.sin(6.283184*e)},o=function(e){return.003959503758*Math.pow(2,(e-128)/12)},s=function(e,t,n){var a,i,r,s,c,w,l,u=d[e.i[0]],h=e.i[1],p=e.i[3],y=d[e.i[4]],f=e.i[5],x=e.i[8],v=e.i[9],g=e.i[10]*e.i[10]*4,m=e.i[11]*e.i[11]*4,b=e.i[12]*e.i[12]*4,C=1/b,K=e.i[13],S=n*Math.pow(2,2-e.i[14]),M=new Int32Array(g+m+b),D=0,I=0;for(a=0,i=0;g+m+b>a;a++,i++)0>i||(i-=S,w=o(t+(15&(K=K>>8|(255&K)<<4))+e.i[2]-128),l=o(t+(15&K)+e.i[6]-128)*(1+8e-4*e.i[7])),r=1,g>a?r=a/g:g+m>a||(r-=(a-g-m)*C),s=w,p&&(s*=r*r),c=u(D+=s)*h,s=l,x&&(s*=r*r),c+=y(I+=s)*f,v&&(c+=(2*Math.random()-1)*v),M[a]=80*c*r|0;return M},d=[r,function(e){return.5>e%1?1:-1},function(e){return e%1*2-1},function(e){var t=e%1*4;return 2>t?t-1:3-t}];this.init=function(r){e=r,t=r.endPattern,n=0,a=r.rowLen*r.patternLen*(t+1)*2,i=new Int32Array(a)},this.generate=function(){var o,c,w,l,u,h,p,y,f,x,v,g,m,b,C=new Int32Array(a),K=e.songData[n],S=e.rowLen,M=e.patternLen,D=0,I=0,X=!1,E=[];for(w=0;t>=w;++w)for(p=K.p[w],l=0;M>l;++l){var L=p?K.c[p-1].f[l]:0;L&&(K.i[L-1]=K.c[p-1].f[l+M]||0,16>L&&(E=[]));var W=d[K.i[15]],Y=K.i[16]/512,H=Math.pow(2,K.i[17]-9)/S,z=K.i[18],A=K.i[19],k=43.23529*K.i[20]*3.141592/44100,R=1-K.i[21]/255,F=1e-5*K.i[22],B=K.i[23]/32,O=K.i[24]/512,P=6.283184*Math.pow(2,K.i[25]-9)/S,_=K.i[26]/255,T=K.i[27]*S&-2;for(v=(w*M+l)*S,u=0;4>u;++u)if(h=p?K.c[p-1].n[l+u*M]:0){E[h]||(E[h]=s(K,h,S));var G=E[h];for(c=0,o=2*v;c<G.length;c++,o+=2)C[o]+=G[c]}for(c=0;S>c;c++)(x=C[y=2*(v+c)])||X?(g=k,z&&(g*=W(H*y)*Y+.5),I+=(g=1.5*Math.sin(g))*(m=R*(x-I)-(D+=g*I)),x=3==A?I:1==A?m:D,F&&(x=1>(x*=F)?x>-1?r(.25*x):-1:1,x/=F),X=(x*=B)*x>1e-5,b=x*(1-(f=Math.sin(P*y)*O+.5)),x*=f):b=0,T>y||(b+=C[y-T+1]*_,x+=C[y-T]*_),C[y]=0|b,C[y+1]=0|x,i[y]+=0|b,i[y+1]+=0|x}return++n/e.numChannels},this.createWave=function(){var e=44+2*a-8,t=e-36,n=new Uint8Array(44+2*a);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var r=0,o=44;a>r;++r){var s=i[r];s=-32767>s?-32767:s>32767?32767:s,n[o++]=255&s,n[o++]=s>>8&255}return n},this.getBuffer=function(){return i},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),a=new Array(t),r=0;2*t>r;r+=1){var o=n+r;a[r]=e>0&&o<i.length?i[o]/32768:0}return a}},a={songData:[{i:[3,138,116,0,0,138,128,4,0,0,47,48,166,124,3,0,139,4,1,3,64,160,3,32,147,4,121,5],p:[1,1,4,2,3],c:[{n:[111],f:[]},{n:[114],f:[]},{n:[113],f:[]},{n:[112,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,113],f:[]}]}],rowLen:5513,patternLen:32,endPattern:4,numChannels:1},i={songData:[{i:[2,138,116,0,2,138,128,4,0,0,1,29,52,124,3,0,139,4,1,3,64,160,3,32,147,4,57,5],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,150],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[1],c:[{n:[],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:2};function r(e,t,n,a,i="#F0F"){actx.fillStyle=i,actx.fillRect(e,t,n,a)}function o(e,t,n=4,a=2,i="#FF0"){actx.fillStyle=i,actx.beginPath(),actx.ellipse(e,t,n,a,0,0,2*Math.PI),actx.fill()}function s(e,t){let n=document.createElement("canvas");return n.width=e,n.height=t,{c:n,ctx:n.getContext("2d")}}player={type:"player",x:0,y:0,width:64,height:64,xVel:0,yVel:0,xAcc:0,yAcc:0,drag:10,speed:.05,draw:function(e){actx=gamectx,actx.drawImage(spriteSheet.c,0,0,100,100,this.x-viewX-this.width/2,this.y-viewY-this.height/2,100,100)},update:function(e){Key.isDown(Key.a)?this.x-=this.speed:Key.isDown(Key.d)&&(this.x+=this.speed),Key.isDown(Key.w)?this.y-=this.speed:Key.isDown(Key.s)&&(this.y+=this.speed)}},states={},init=(()=>{audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),audioMaster.connect(audioCtx.destination),fps=60,tick=1/60,dt=0,start=elapsed=now=last=timeStamp(),state="play",sounds={},prng=new t(1019),data=[],worldWidth=10240,worldHeight=10240,deadzoneX=100,deadzoneY=100,player.x=400,player.y=400,viewX=player.x-320,viewY=player.y-180,viewW=640,viewH=360,obstacleCount=1e3,bg=s(worldWidth,worldHeight),spriteSheet=s(1e3,1e3),obstacles=[],createObstacles(),c.width=640,c.height=360,c.style="width: 1280px; height: 720px",gamectx=c.getContext("2d"),function(){bg.ctx.fillStyle="#181",bg.ctx.fillRect(0,0,worldWidth,worldHeight),actx=bg.ctx;for(let e=0;8e4>e;e++)o(prng.nextBoundedInt(0,worldWidth),prng.nextBoundedInt(0,worldHeight),40,20,"rgba(10,50,0,0.05)")}(),drawSprites(),actx=spriteSheet.ctx,actx.translate(sprites.player.x,sprites.player.y),o(50,50,40,40,"white"),actx.restore,actx=spriteSheet.ctx,actx.save(),actx.translate(sprites.obstacle.x,sprites.obstacle.y),r(20,20,60,60,"#400"),actx.restore(),music=new n,music.init(a),done=!1,soundsReady=0,sndData=[{name:"song",data:a},{name:"cellComplete",data:i}],sndData.forEach(function(t){var a=new n;a.init(t.data);var i=!1;setInterval(function(){if(!i&&(i=1==a.generate())){let n=a.createWave().buffer;audioCtx.decodeAudioData(n,function(n){sounds[t.name]=n,soundsReady++,gameSong=e(sounds.song,1,0,.5,!0)})}},0)}),paused=!1,loop()}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),loop=(()=>{for(now=timeStamp(),dt+=Math.min(1,(now-last)/1e3),elapsed=now-start;dt>tick;)dt-=tick,states[state].step(tick);states[state].draw(dt),requestAnimationFrame(loop)}),timeStamp=(()=>window.performance&&window.performance.now?window.performance.now():(new Date).getTime()),createObstacles=(()=>{for(let e=0;e<obstacleCount;e++)obstacles.push({type:"obstacle",x:prng.nextBoundedInt(0,worldWidth),y:prng.nextBoundedInt(0,worldHeight),width:40,height:40})}),drawObstacles=(()=>{obstacles.forEach(function(e,t,n){var a,i,r;(function(e,t,n=64){return!(0-n>e||e>viewW+n||0-n>t||t>viewH+n)})(e.x-viewX,e.y-viewH)&&(a=sprites.obstacle,i=e.x-viewX,r=e.y-viewY,actx.drawImage(spriteSheet.c,a.x,a.y,a.width,a.height,i,r,a.width,a.height))})}),sprites={player:{x:0,y:0,width:100,height:100},obstacle:{x:100,y:0,width:80,height:80}},drawSprites=(()=>{}),states.play={draw:function(e){actx=gamectx,r(0,0,c.width,c.height,"red"),actx.drawImage(bg.c,viewX,viewY,640,360,0,0,640,360),player.draw(e),drawObstacles()},step:function(t){Key.justReleased(Key.r)&&(e(sounds.cellComplete,1,0,.5,!1),Key.update()),player.update(),player.x-viewX+deadzoneX>viewW?viewX=player.x-(viewW-deadzoneX):player.x-deadzoneX<viewX&&(viewX=player.x-deadzoneX),player.y-viewY+deadzoneY>viewH?viewY=player.y-(viewH-deadzoneY):player.y-deadzoneY<viewY&&(viewY=player.y-deadzoneY)}},window.init()}();
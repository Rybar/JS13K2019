!function(){function e(e,t=1,n=0,a=.5,i=!1){var r=audioCtx.createBufferSource(),s=audioCtx.createGain(),o=audioCtx.createStereoPanner();return r.buffer=e,r.connect(o),o.connect(s),s.connect(audioMaster),r.playbackRate.value=t,r.loop=i,s.gain.value=a,o.pan.value=n,r.start(),{volume:s,sound:r}}states={},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}};class t{constructor(e){if(e%1!=0)throw new Error("Seed value must be an integer.");this.seed=e%2147483647,this.seed>0||(this.seed+=2147483646)}next(){return this.seed=16807*this.seed%2147483647}nextFloat(){return(this.next()-1)/2147483646}nextBoundedInt(e,t){return Math.floor(this.nextFloat()*(t-e)+e)}}boxBox=((e,t)=>{let n=e.x,a=e.x+e.width,i=e.y,r=e.y+e.height,s=t.x,o=t.x+t.width,d=t.y,c=t.y+t.height;return!(s>a||n>o||d>r||i>c)});var n=function(){var e,t,n,a,i,r=function(e){return Math.sin(6.283184*e)},s=function(e){return.003959503758*Math.pow(2,(e-128)/12)},o=function(e,t,n){var a,i,r,o,c,u,l,h=d[e.i[0]],p=e.i[1],w=e.i[3],y=d[e.i[4]],f=e.i[5],x=e.i[8],g=e.i[9],v=e.i[10]*e.i[10]*4,m=e.i[11]*e.i[11]*4,b=e.i[12]*e.i[12]*4,C=1/b,K=e.i[13],S=n*Math.pow(2,2-e.i[14]),M=new Int32Array(v+m+b),D=0,I=0;for(a=0,i=0;v+m+b>a;a++,i++)0>i||(i-=S,u=s(t+(15&(K=K>>8|(255&K)<<4))+e.i[2]-128),l=s(t+(15&K)+e.i[6]-128)*(1+8e-4*e.i[7])),r=1,v>a?r=a/v:v+m>a||(r-=(a-v-m)*C),o=u,w&&(o*=r*r),c=h(D+=o)*p,o=l,x&&(o*=r*r),c+=y(I+=o)*f,g&&(c+=(2*Math.random()-1)*g),M[a]=80*c*r|0;return M},d=[r,function(e){return.5>e%1?1:-1},function(e){return e%1*2-1},function(e){var t=e%1*4;return 2>t?t-1:3-t}];this.init=function(r){e=r,t=r.endPattern,n=0,a=r.rowLen*r.patternLen*(t+1)*2,i=new Int32Array(a)},this.generate=function(){var s,c,u,l,h,p,w,y,f,x,g,v,m,b,C=new Int32Array(a),K=e.songData[n],S=e.rowLen,M=e.patternLen,D=0,I=0,E=!1,L=[];for(u=0;t>=u;++u)for(w=K.p[u],l=0;M>l;++l){var A=w?K.c[w-1].f[l]:0;A&&(K.i[A-1]=K.c[w-1].f[l+M]||0,16>A&&(L=[]));var Y=d[K.i[15]],k=K.i[16]/512,R=Math.pow(2,K.i[17]-9)/S,z=K.i[18],F=K.i[19],B=43.23529*K.i[20]*3.141592/44100,O=1-K.i[21]/255,P=1e-5*K.i[22],_=K.i[23]/32,W=K.i[24]/512,H=6.283184*Math.pow(2,K.i[25]-9)/S,T=K.i[26]/255,X=K.i[27]*S&-2;for(g=(u*M+l)*S,h=0;4>h;++h)if(p=w?K.c[w-1].n[l+h*M]:0){L[p]||(L[p]=o(K,p,S));var G=L[p];for(c=0,s=2*g;c<G.length;c++,s+=2)C[s]+=G[c]}for(c=0;S>c;c++)(x=C[y=2*(g+c)])||E?(v=B,z&&(v*=Y(R*y)*k+.5),I+=(v=1.5*Math.sin(v))*(m=O*(x-I)-(D+=v*I)),x=3==F?I:1==F?m:D,P&&(x=1>(x*=P)?x>-1?r(.25*x):-1:1,x/=P),E=(x*=_)*x>1e-5,b=x*(1-(f=Math.sin(H*y)*W+.5)),x*=f):b=0,X>y||(b+=C[y-X+1]*T,x+=C[y-X]*T),C[y]=0|b,C[y+1]=0|x,i[y]+=0|b,i[y+1]+=0|x}return++n/e.numChannels},this.createWave=function(){var e=44+2*a-8,t=e-36,n=new Uint8Array(44+2*a);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var r=0,s=44;a>r;++r){var o=i[r];o=-32767>o?-32767:o>32767?32767:o,n[s++]=255&o,n[s++]=o>>8&255}return n},this.getBuffer=function(){return i},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),a=new Array(t),r=0;2*t>r;r+=1){var s=n+r;a[r]=e>0&&s<i.length?i[s]/32768:0}return a}},a={songData:[{i:[3,138,116,0,0,138,128,4,0,0,47,48,166,124,3,0,139,4,1,3,64,160,3,32,147,4,121,5],p:[1,1,4,2,3],c:[{n:[111],f:[]},{n:[114],f:[]},{n:[113],f:[]},{n:[112,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,113],f:[]}]}],rowLen:5513,patternLen:32,endPattern:4,numChannels:1},i={songData:[{i:[2,138,116,0,2,138,128,4,0,0,1,29,52,124,3,0,139,4,1,3,64,160,3,32,147,4,57,5],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,150],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[1],c:[{n:[],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:2};function r(e,t,n,a,i="#F0F"){actx.fillStyle=i,actx.fillRect(e,t,n,a)}function s(e,t,n=4,a=2,i="#FF0"){actx.fillStyle=i,actx.beginPath(),actx.ellipse(e,t,n,a,0,0,2*Math.PI),actx.fill()}function o(e,t){let n=document.createElement("canvas");return n.width=e,n.height=t,{c:n,ctx:n.getContext("2d")}}player={type:"player",x:0,y:0,width:64,height:64,xVel:0,yVel:0,xAcc:0,yAcc:0,drag:10,speed:.05,draw:function(e){actx=gamectx,actx.drawImage(spriteSheet.c,0,0,100,100,this.x-d[6]-this.width/2,this.y-viewY-this.height/2,100,100)},update:function(e){Key.isDown(Key.a)?this.x-=this.speed:Key.isDown(Key.d)&&(this.x+=this.speed),Key.isDown(Key.w)?this.y-=this.speed:Key.isDown(Key.s)&&(this.y+=this.speed)}},states={},init=(()=>{audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),audioMaster.connect(audioCtx.destination),fps=60,tick=1/60,dt=0,start=elapsed=now=last=timeStamp(),state="play",sounds={},prng=new t(1019),d=[10240,10240,100,400,400,400,player.x-320,player.y=180,640,360,1e3],bg=o(d[0],d[1]),spriteSheet=o(1e3,1e3),obstacles=[],createObstacles(),c.width=640,c.height=360,c.style="width: 1280px; height: 720px",gamectx=c.getContext("2d"),function(){bg.ctx.fillStyle="#181",bg.ctx.fillRect(0,0,d[0],d[1]),actx=bg.ctx;for(let e=0;8e4>e;e++)s(prng.nextBoundedInt(0,d[0]),prng.nextBoundedInt(0,d[1]),40,20,"rgba(10,50,0,0.05)")}(),drawSprites(),actx=spriteSheet.ctx,actx.translate(sprites.player.x,sprites.player.y),s(50,50,40,40,"white"),actx.restore,actx=spriteSheet.ctx,actx.save(),actx.translate(sprites.obstacle.x,sprites.obstacle.y),r(20,20,60,60,"#400"),actx.restore(),music=new n,music.init(a),done=!1,soundsReady=0,sndData=[{name:"song",data:a},{name:"cellComplete",data:i}],sndData.forEach(function(t){var a=new n;a.init(t.data);var i=!1;setInterval(function(){if(!i&&(i=1==a.generate())){let n=a.createWave().buffer;audioCtx.decodeAudioData(n,function(n){sounds[t.name]=n,soundsReady++,gameSong=e(sounds.song,1,0,.5,!0)})}},0)}),paused=!1,loop()}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),loop=(()=>{for(now=timeStamp(),dt+=Math.min(1,(now-last)/1e3),elapsed=now-start;dt>tick;)dt-=tick,states[state].step(tick);states[state].draw(dt),requestAnimationFrame(loop)}),timeStamp=(()=>window.performance&&window.performance.now?window.performance.now():(new Date).getTime()),createObstacles=(()=>{for(let e=0;e<obstacleCount;e++)obstacles.push({type:"obstacle",x:prng.nextBoundedInt(0,d[0]),y:prng.nextBoundedInt(0,d[1]),width:40,height:40})}),drawObstacles=(()=>{obstacles.forEach(function(e,t,n){var a,i,r;(function(e,t,n=64){return!(0-n>e||e>viewW+n||0-n>t||t>viewH+n)})(e.x-d[6],e.y-viewH)&&(a=sprites.obstacle,i=e.x-d[6],r=e.y-viewY,actx.drawImage(spriteSheet.c,a.x,a.y,a.width,a.height,i,r,a.width,a.height))})}),sprites={player:{x:0,y:0,width:100,height:100},obstacle:{x:100,y:0,width:80,height:80}},drawSprites=(()=>{}),states.play={draw:function(e){actx=gamectx,r(0,0,c.width,c.height,"red"),actx.drawImage(bg.c,d[6],viewY,640,360,0,0,640,360),player.draw(e),drawObstacles()},step:function(t){Key.justReleased(Key.r)&&(e(sounds.cellComplete,1,0,.5,!1),Key.update()),player.update(),player.x-d[6]+deadzoneX>viewW?d[6]=player.x-(viewW-deadzoneX):player.x-deadzoneX<d[6]&&(d[6]=player.x-deadzoneX),player.y-viewY+deadzoneY>viewH?viewY=player.y-(viewH-deadzoneY):player.y-deadzoneY<viewY&&(viewY=player.y-deadzoneY)}},window.init()}();